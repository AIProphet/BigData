# 脚本

### 一、准备

* [获得cleaner.jar](https://github.com/sunnyandgood/BigData/blob/master/脚本-定时器/cleaner.jar)

* 上传

### 二、执行脚本

* 执行a1.sh脚本

     * a1.sh脚本的内容
     
            CURRENT=`/bin/date +%Y%m%d`

            /softWare/hadoop-2.2.0/bin/hadoop jar /cleaner.jar /flume/$CURRENT /cleaned/$CURRENT

     * 执行a1.sh脚本
     
           # chmod +x a1.sh
           # ./a1.sh

* 执行a2.sh脚本

    * 创建外部分区表
    
            create external table wxkj(ip string,time string,urls string) partitioned by (logdate string) 
                                        row format delimited fields terminated by '\t' location '/cleaned';

    * a2.sh脚本的内容('-e' 表示不用启动hive直接在外部执行)
          
            CURRENT=`/bin/date +%Y%m%d`
            /softWare/apache-hive-0.13.0-bin/bin/hive -e "alter table wxkj 
                    add partition (logdate=$CURRENT) location '/cleaned/$CURRENT'"    
    
    * 执行脚本
 
           # chmod +x a1.sh
           # ./a1.sh   
    
    
            hive> select * from wxkj limit 4; 
            OK
            110.52.250.126	20130530173820	data/cache/style_1_widthauto.css?y7a	20180731
            110.52.250.126	20130530173820	source/plugin/wsh_wx/img/wsh_zk.css	20180731
            110.52.250.126	20130530173820	data/cache/style_1_forum_index.css?y7a	20180731
            110.52.250.126	20130530173820	source/plugin/wsh_wx/img/wx_jqr.gif	20180731    
    
    
    
    
    
    
    
    
     



           
           
