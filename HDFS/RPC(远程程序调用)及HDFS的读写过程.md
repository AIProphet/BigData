## RPC(Remote Procedure Call远程程序调用)及HDFS的读写过程

### 一、Remote Procedure Call
* RPC——远程过程调用协议，它是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。RPC协议假定某些传输协议的存在，如TCP或UDP，为通信程序之间携带信息数据。在OSI网络通信模型中，RPC跨越了传输层和应用层。RPC使得开发包括网络分布式多程序在内的应用程序更加容易。

* RPC采用客户机/服务器模式。请求程序就是一个客户机，而服务提供程序就是一个服务器。首先，客户机调用进程发送一个有进程参数的调用信息到服务进程，然后等待应答信息。在服务器端，进程保持睡眠状态直到调用信息的到达为止。当一个调用信息到达，服务器获得进程参数，计算结果，发送答复信息，然后等待下一个调用信息，最后，客户端调用进程接收答复信息，获得进程结果，然后调用执行继续进行。

* hadoop的整个体系结构就是构建在RPC之上的(见org.apache.hadoop.ipc)。

### 二、HDFS读过程
* 1、初始化FileSystem，然后客户端(client)用FileSystem的open()函数打开文件
* 2、FileSystem用RPC调用元数据节点，得到文件的数据块信息，对于每一个数据块，元数据节点返回保存数据块的数据节点的地址。
* 3、FileSystem返回FSDataInputStream给客户端，用来读取数据，客户端调用stream的read()函数开始读取数据。
* 4、DFSInputStream连接保存此文件第一个数据块的最近的数据节点，data从数据节点读到客户端(client)
* 5、当此数据块读取完毕时，DFSInputStream关闭和此数据节点的连接，然后连接此文件下一个数据块的最近的数据节点。
* 6、当客户端读取完毕数据的时候，调用FSDataInputStream的close函数。
* 7、在读取数据的过程中，如果客户端在与数据节点通信出现错误，则尝试连接包含此数据块的下一个数据节点。
* 8、失败的数据节点将被记录，以后不再连接。
